{% extends "base.html" %}

{% block title %}{{ evaluation.module }} - Détail{% endblock %}

{% block content %}
<div class="evaluation-detail">
    <h1>{{ evaluation.module }}</h1>
    <p class="eval-contexte">{{ evaluation.contexte }}</p>
    
    <div class="section-card">
        <h2>Items évalués ({{ items|length }})</h2>
        <div class="items-grid">
            {% for item in items %}
            <div class="item-card">
                <div class="item-header">
                    <span class="competence-badge">{{ item.competence_code }}</span>
                    <strong>{{ item.code_item }}</strong>
                </div>
                <p class="item-desc">{{ item.description }}</p>
                <p class="item-sub">{{ item.sous_item[:100] }}...</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="section-card">
        <h2>Validations par utilisateur</h2>
        <div class="validations-table">
            <table>
                <thead>
                    <tr>
                        <th>Utilisateur</th>
                        <th>Classe</th>
                        <th>Items validés</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in utilisateurs %}
                    <tr>
                        <td>{{ user.prenom }} {{ user.nom }}</td>
                        <td>{{ user.classe }}</td>
                        <td>
                            {% set user_validations = validations|selectattr('utilisateur_id', 'equalto', user.id)|list %}
                            {{ user_validations|length }}/{{ items|length }}
                        </td>
                        <td>
                            <a href="{{ url_for('page_validation', evaluation_id=evaluation.id, utilisateur_id=user.id) }}" 
                               class="btn-primary">
                                Valider
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}