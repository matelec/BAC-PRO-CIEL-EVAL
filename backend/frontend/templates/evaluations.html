{% extends "base.html" %}

{% block title %}Gestion des Évaluations - BAC PRO CIEL{% endblock %}
{% block page_scripts %}
<!-- Script spécifique au module utilisateurs -->
<script src="{{ url_for('static', filename='evaluations.js') }}"></script>
{% endblock %}

{% block content %}
<div class="evaluations-page">

      <!-- En-tête de page -->
    <div class="page-header">
        <div class="page-title">
            <h1><i class="fas fa-users"></i> Gestion des Evaluations</h1>
        </div>    
        <div class="header-actions">
            <button class="btn-primary" id="toggleAjoutEvalBtn">
                <i class="fas fa-user-plus"></i> Ajout d'une évaluation
            </button> 
        </div>
    </div>
    
    <!-- Section 1: Ajouter une evaluation (cachée par défaut) -->
    <div class="section-card" id="ajoutEval" style="display: none;">
        <div class="card-header">
            <h2><i class="fas fa-user-plus"></i>Créer une nouvelle évaluation</h2>
        </div>
        <div class="card-body">
            <div class="evaluation-form">    
                <form method="POST" action="{{ url_for('creer_evaluation') }}">
                    <div class="form-group">
                    <label>Pôle:</label>
                    <select type="text" name="pole" required>
                        <option value="">Sélectionner un pôle</option>
                        <option value="Réalisation et maintenance de produits électroniques">Réalisation et maintenance de produits électroniques</option>
                        <option value="Mise en service de réseaux informatiques">Mise en service de réseaux informatiques</option>
                        <option value="Valorisation de la donnée et cybersécurité">Valorisation de la donnée et cybersécurité</option>
                    </select>
                    </div>
                    <div class="form-group">
                    <label>Module:</label>
                    <input type="text" name="module" placeholder="Nom du module" required>
                    </div>
                    <div class="form-group">
                    <label>Contexte:</label>
                    <textarea name="contexte" placeholder="Contexte pédagogique..." rows="3"></textarea>
                    </div>
            </div>     
            <div class="form-group">
                <label>Sélectionner les items à évaluer:</label>
                <div class="items-selection">
                    {% for competence in competences %}
                    <div class="competence-group">
                        <h4>{{ competence.code }} - {{ competence.libelle }}</h4>
                        <div class="items-list">
                            {% for item in items %}
                            {% if item.competence_code == competence.code %}
                            <label class="item-checkbox">
                                <input type="checkbox" name="items_ids" value="{{ item.id }}">
                                <span class="item-code">{{ item.code_item }}</span>
                                <span class="item-desc">{{ item.description }}</span>
                            </label>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
            
            <button type="submit" class="btn-primary">Créer l'évaluation</button>
        </form>
    </div>

    <div class="section-card">
        <h2>Évaluations existantes ({{ evaluations|length }})</h2>
        <div class="evaluations-list">
            {% for eval in evaluations %}
            <div class="evaluation-card">
                <div class="eval-info">
                    <h2>{{ eval.pole }}</h2>
                    <h3>{{ eval.module }}</h3>
                    <p>{{ eval.contexte }}</p>
                    <small>Créé le {{ eval.date_creation[:10] }} • {{ eval.nombre_items }} items</small>
                </div>
                <div class="eval-actions">
                    <a href="{{ url_for('detail_evaluation', evaluation_id=eval.id) }}" class="btn-primary">
                        Détail
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}